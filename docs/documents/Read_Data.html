<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>Read Data | Node.js SDK for digi.me</title><meta name="description" content="Documentation for Node.js SDK for digi.me"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><link rel="stylesheet" href="../assets/custom.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">Node.js SDK for digi.me</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">Node.js SDK for digi.me</a></li><li><a href="Read_Data.html">Read Data</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="read-data" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Read Data<a href="#read-data" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><p>Before data can be read, you must already have a user access token for this user.</p>
<p>If not, you will need to <a href="User_creation_and_authorization.Authorizing.html">authorize them</a> first and ask them to <a href="Manage_your_accounts_(sources).Onboarding_Additional_Sources.html">onboard any extra services</a> to provide the data you are requesting.</p>
<a id="getting-a-read-session" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Getting a Read Session<a href="#getting-a-read-session" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>To start reading user data, we first need to obtain a session:</p>
<pre><code class="typescript"><span class="hl-9">// initialize the SDK</span><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">init</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@digime/digime-sdk-nodejs&quot;</span><span class="hl-1">;</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">sdk</span><span class="hl-1"> = </span><span class="hl-0">init</span><span class="hl-1">({ </span><span class="hl-4">applicationId</span><span class="hl-1"> });</span><br/><br/><span class="hl-9">// contractDetails - The same one used in getAuthorizeUrl().</span><br/><span class="hl-9">// userAccessToken - The user access token from the authorization step.</span><br/><span class="hl-9">// sessionOptions - (Optional) An limits or scopes to set for this session.</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> { </span><span class="hl-6">session</span><span class="hl-1">, </span><span class="hl-6">updatedAccessToken</span><span class="hl-1"> } = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">sdk</span><span class="hl-1">.</span><span class="hl-0">readSession</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-4">contractDetails</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">userAccessToken</span><span class="hl-1">,</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>The <a href="../interfaces/Types.Session.html" class="tsd-kind-interface">session</a> received can now be used to query data.</p>
<p>More information on the limits and scoping of the raw and mapped data interface can be found <a href="../interfaces/Types.PullSessionOptions.html" class="tsd-kind-interface">here</a>.</p>
<a id="reading-all-files" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Reading All Files<a href="#reading-all-files" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Using the session received above, we can trigger the <a href="../interfaces/SDK.DigimeSDK.html#readallfiles" class="tsd-kind-property">readAllFiles</a> method to read all available files from this user.</p>
<pre><code class="typescript"><span class="hl-9">// ... initialize the SDK</span><br/><br/><span class="hl-9">// session - The session we received from readSession().</span><br/><span class="hl-9">// privateKey - The private key for this contract.</span><br/><span class="hl-9">// contractId - Your contract id</span><br/><span class="hl-9">// userAccessToken - The user access token from the authorization step.</span><br/><span class="hl-9">// onFileData - A function that will be called when a file is successfully downloaded.</span><br/><span class="hl-9">// onFileError - A function that will be called when an error occurs when downloading a file.</span><br/><span class="hl-9">// onStatusChange - A function that will be called when file list status is changed.</span><br/><span class="hl-9">// onAccessTokenChange - A function that will be called when AccessToken is changed.</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> { </span><span class="hl-6">stopPolling</span><span class="hl-1">, </span><span class="hl-6">filePromise</span><span class="hl-1"> } = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">sdk</span><span class="hl-1">.</span><span class="hl-0">readAllFiles</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-4">sessionKey:</span><span class="hl-1"> </span><span class="hl-4">session</span><span class="hl-1">.</span><span class="hl-4">key</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">privateKey:</span><span class="hl-1"> &lt;</span><span class="hl-7">private</span><span class="hl-1">-</span><span class="hl-7">key</span><span class="hl-1">-</span><span class="hl-7">of</span><span class="hl-1">-</span><span class="hl-7">contract</span><span class="hl-1">&gt;,</span><br/><span class="hl-1">    </span><span class="hl-4">contractId:</span><span class="hl-1"> &lt;</span><span class="hl-7">your</span><span class="hl-1">-</span><span class="hl-7">contract</span><span class="hl-1">-</span><span class="hl-7">id</span><span class="hl-1">&gt;,</span><br/><span class="hl-1">    </span><span class="hl-4">userAccessToken</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">onFileData</span><span class="hl-4">:</span><span class="hl-1"> ({</span><span class="hl-4">fileData</span><span class="hl-1">, </span><span class="hl-4">fileName</span><span class="hl-1">, </span><span class="hl-4">fileMetadata</span><span class="hl-1">}) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-9">// This is where you deal with any data you receive from digi.me,</span><br/><span class="hl-1">        </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">data</span><span class="hl-1"> = </span><span class="hl-6">JSON</span><span class="hl-1">.</span><span class="hl-0">parse</span><span class="hl-1">(</span><span class="hl-4">fileData</span><span class="hl-1">.</span><span class="hl-0">toString</span><span class="hl-1">(</span><span class="hl-2">&quot;utf8&quot;</span><span class="hl-1">));</span><br/><span class="hl-1">        </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;Retrieved: &quot;</span><span class="hl-1">, </span><span class="hl-4">fileName</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;Metadata:</span><span class="hl-11">\n</span><span class="hl-2">&quot;</span><span class="hl-1">, </span><span class="hl-6">JSON</span><span class="hl-1">.</span><span class="hl-0">stringify</span><span class="hl-1">(</span><span class="hl-4">fileMetadata</span><span class="hl-1">, </span><span class="hl-5">null</span><span class="hl-1">, </span><span class="hl-8">2</span><span class="hl-1">));</span><br/><span class="hl-1">        </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;Content:</span><span class="hl-11">\n</span><span class="hl-2">&quot;</span><span class="hl-1">, </span><span class="hl-6">JSON</span><span class="hl-1">.</span><span class="hl-0">stringify</span><span class="hl-1">(</span><span class="hl-4">data</span><span class="hl-1">, </span><span class="hl-5">null</span><span class="hl-1">, </span><span class="hl-8">2</span><span class="hl-1">));</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-0">onFileError</span><span class="hl-4">:</span><span class="hl-1"> ({</span><span class="hl-4">fileName</span><span class="hl-1">, </span><span class="hl-4">error</span><span class="hl-1">}) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Error retrieving file </span><span class="hl-5">${</span><span class="hl-4">fileName</span><span class="hl-5">}</span><span class="hl-2">: </span><span class="hl-5">${</span><span class="hl-4">error</span><span class="hl-12">.</span><span class="hl-0">toString</span><span class="hl-12">()</span><span class="hl-5">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-0">onStatusChange</span><span class="hl-1">(</span><span class="hl-4">response</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;File list status changed: &quot;</span><span class="hl-1">, </span><span class="hl-4">response</span><span class="hl-1">);</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-0">onAccessTokenChange</span><span class="hl-1">(</span><span class="hl-4">response</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-9">// Add logic to save new access token</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-9">// filePromise is a promise that will resolve when data fetching is complete.</span><br/><span class="hl-9">// stopPolling is a function that you can call if you would like to stop the process when it&#39;s still running.</span>
</code><button type="button">Copy</button></pre>

<p>The type of FileMetadata that is returned depends on the type of data it is. Please see <a href="Read_Data.File_Metadata.html">here</a> for more information.</p>
<a id="selecting-files" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Selecting Files<a href="#selecting-files" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>If you'd like more control over the downloading of the files, we can call <a href="../interfaces/SDK.DigimeSDK.html#readfilelist" class="tsd-kind-property">readFileList</a> to see all available files from this user:</p>
<pre><code class="typescript"><span class="hl-9">// ... initialize the SDK</span><br/><span class="hl-9">// session - The session we received from readSession().</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">response</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">sdk</span><span class="hl-1">.</span><span class="hl-0">readFileList</span><span class="hl-1">({ </span><span class="hl-4">sessionKey:</span><span class="hl-1"> </span><span class="hl-4">session</span><span class="hl-1">.</span><span class="hl-4">key</span><span class="hl-1"> });</span>
</code><button type="button">Copy</button></pre>

<p><a href="../interfaces/Types.ReadFileListResponse.html" class="tsd-kind-interface">Response</a> among other props contains a <code>fileList</code> and <code>status</code> of each user service onboarded.</p>
<p>You can then download the files manually using <a href="../interfaces/SDK.DigimeSDK.html#readfile" class="tsd-kind-property">readFile()</a>.</p>
<pre><code class="typescript"><span class="hl-9">// ... initialize the SDK</span><br/><span class="hl-9">// session - The session we received from readSession().</span><br/><span class="hl-9">// fileName - The file object from getFileList() that you want to download.</span><br/><span class="hl-9">// privateKey - private key of your contract.</span><br/><span class="hl-9">// contractId - Your contract id</span><br/><span class="hl-9">// userAccessToken - The user access token from the authorization step.</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">data</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">sdk</span><span class="hl-1">.</span><span class="hl-0">readFile</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-4">sessionKey:</span><span class="hl-1"> </span><span class="hl-4">session</span><span class="hl-1">.</span><span class="hl-4">key</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">fileName:</span><span class="hl-1"> </span><span class="hl-4">file</span><span class="hl-1">.</span><span class="hl-4">name</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">privateKey</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">contractId</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">userAccessToken</span><span class="hl-1">,</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>If you want to download just file metadata please use similar approach with method <a href="../interfaces/SDK.DigimeSDK.html#readfilemetadata" class="tsd-kind-property">readFileMetadata()</a>.</p>
<p>Note that readAllFiles is helper method that uses readFileList and readFile methods to return entire data set and also help user maintain latest access token and file list status. If readFileList and readFile methods are used please add logic to maintain latest access token since both of these method will try to do refresh of token automatically.</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#read-data"><span>Read <wbr/>Data</span></a><ul><li><a href="#getting-a-read-session"><span>Getting a <wbr/>Read <wbr/>Session</span></a></li><li><a href="#reading-all-files"><span>Reading <wbr/>All <wbr/>Files</span></a></li><li><a href="#selecting-files"><span>Selecting <wbr/>Files</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">Node.js SDK for digi.me</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>
