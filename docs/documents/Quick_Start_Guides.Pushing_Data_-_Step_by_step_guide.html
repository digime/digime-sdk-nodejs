<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>Pushing Data - Step by step guide | Node.js SDK for digi.me</title><meta name="description" content="Documentation for Node.js SDK for digi.me"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><link rel="stylesheet" href="../assets/custom.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">Node.js SDK for digi.me</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">Node.js SDK for digi.me</a></li><li><a href="Quick_Start_Guides.html">Quick Start Guides</a></li><li><a href="Quick_Start_Guides.Pushing_Data_-_Step_by_step_guide.html">Pushing Data - Step by step guide</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="pushing-data---step-by-step-guide" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Pushing Data - Step by step guide<a href="#pushing-data---step-by-step-guide" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><p>Use this guide to push data to your user's library in <a href="http://digi.me">digi.me</a>.</p>
<p>Currently, the &quot;push to provider&quot; functionality is only supported for MedMij, and it follows a slightly different approach for how data is pushed. We will explain this below.</p>
<p>To access the <a href="http://digi.me">digi.me</a> platform, you need an application ID, a contract for writing data, and its private key.</p>
<p>For more details, please check <a href="Quick_Start_Guides.Getting_Started.html">Getting Started</a>.</p>
<a id="1-onboarding-and-authorization" class="tsd-anchor"></a><h2 class="tsd-anchor-link">1. Onboarding and Authorization<a href="#1-onboarding-and-authorization" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Before pushing data to a user, you must go through the authorization flow and obtain a user access token.</p>
<p><em>If you already have a user access token for this user from another contract, you will still need to go through this process. Be sure to include any existing user access tokens so we can link them to the same library.</em></p>
<a id="getting-an-authorization-url-and-a-code-verifier" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Getting an authorization URL and a code verifier<a href="#getting-an-authorization-url-and-a-code-verifier" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Begin the process by obtaining the authorization URL by calling <code>getAuthorizeUrl</code>:</p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">init</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@digime/digime-sdk-nodejs&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">sdk</span><span class="hl-1"> = </span><span class="hl-0">init</span><span class="hl-1">({ </span><span class="hl-4">applicationId</span><span class="hl-1"> });</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">contractDetails</span><span class="hl-1"> = {</span><br/><span class="hl-1">    </span><span class="hl-4">contractId:</span><span class="hl-1"> &lt;</span><span class="hl-7">your</span><span class="hl-1">-</span><span class="hl-7">contract</span><span class="hl-1">-</span><span class="hl-7">id</span><span class="hl-1">&gt;,</span><br/><span class="hl-1">    </span><span class="hl-4">privateKey:</span><span class="hl-1"> &lt;</span><span class="hl-7">private</span><span class="hl-1">-</span><span class="hl-7">key</span><span class="hl-1">-</span><span class="hl-7">for</span><span class="hl-1">-</span><span class="hl-7">contract</span><span class="hl-1">-</span><span class="hl-7">id</span><span class="hl-1">&gt;,</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> { </span><span class="hl-6">url</span><span class="hl-1">, </span><span class="hl-6">codeVerifier</span><span class="hl-1"> } = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">sdk</span><span class="hl-1">.</span><span class="hl-0">getAuthorizeUrl</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-4">contractDetails</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">callback:</span><span class="hl-1"> &lt;</span><span class="hl-7">an</span><span class="hl-1">-</span><span class="hl-7">url</span><span class="hl-1">-</span><span class="hl-7">to</span><span class="hl-1">-</span><span class="hl-7">call</span><span class="hl-1">-</span><span class="hl-7">when</span><span class="hl-1">-</span><span class="hl-7">authorization</span><span class="hl-1">-</span><span class="hl-7">is</span><span class="hl-1">-</span><span class="hl-7">done</span><span class="hl-1">&gt;,</span><br/><span class="hl-1">    </span><span class="hl-4">serviceId:</span><span class="hl-1"> </span><span class="hl-0">toNumber</span><span class="hl-1">(</span><span class="hl-4">serviceId</span><span class="hl-1">),</span><br/><span class="hl-1">    </span><span class="hl-4">state:</span><span class="hl-1"> &lt;</span><span class="hl-7">any</span><span class="hl-1">-</span><span class="hl-7">details</span><span class="hl-1">-</span><span class="hl-7">to</span><span class="hl-1">-</span><span class="hl-7">help</span><span class="hl-1">-</span><span class="hl-7">you</span><span class="hl-1">-</span><span class="hl-7">identify</span><span class="hl-1">-</span><span class="hl-7">user</span><span class="hl-1">-</span><span class="hl-7">on</span><span class="hl-1">-</span><span class="hl-7">return</span><span class="hl-1">&gt;,</span><br/><span class="hl-1">    </span><span class="hl-4">userAccessToken:</span><span class="hl-1"> &lt;</span><span class="hl-7">if</span><span class="hl-1">-</span><span class="hl-7">you</span><span class="hl-1">-</span><span class="hl-7">already</span><span class="hl-1">-</span><span class="hl-7">have</span><span class="hl-1">-</span><span class="hl-7">one</span><span class="hl-1">&gt;</span><br/><span class="hl-1">    </span><span class="hl-4">sourceType</span><span class="hl-1">: &lt;</span><span class="hl-7">optional</span><span class="hl-1">-</span><span class="hl-7">use</span><span class="hl-1">-</span><span class="hl-7">only</span><span class="hl-1">-</span><span class="hl-7">for</span><span class="hl-1">-</span><span class="hl-7">push</span><span class="hl-1">-</span><span class="hl-7">to</span><span class="hl-1">-</span><span class="hl-7">provider</span><span class="hl-1">-</span><span class="hl-7">flow</span><span class="hl-1">&gt;</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-9">// Store the codeVerifier against the current user, and redirect them to the url returned.</span><br/><span class="hl-9">// This will kick start the authorization process.</span>
</code><button type="button">Copy</button></pre>

<p>NOTE: Please keep in mind that sourceType needs to be set to push only if you intend to push data to a provider. Currently, this is only supported for Medmij. If sourceType is set to push, only services eligible for the push-to-provider flow will be displayed.</p>
<a id="redirect-the-user" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Redirect the user<a href="#redirect-the-user" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>From the previous step, you will have received a URL to which you can redirect your users to begin the authorization process. Don't forget to store the code verifier associated with this user, as you'll need it later!</p>
<p>An authorization URL should look something like this:</p>
<pre><code><span class="hl-10">https</span><span class="hl-1">:</span><span class="hl-9">//api.digi.me/apps/saas/authorize?code=&lt;code&gt;</span>
</code><button>Copy</button></pre>

<a id="redirect-back-to-your-application" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Redirect back to your application<a href="#redirect-back-to-your-application" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>After the user has onboarded and finished with the authorization, the <code>callback</code> provided will be called.</p>
<p>An example URL might be:</p>
<pre><code><span class="hl-10">https</span><span class="hl-1">:</span><span class="hl-9">//your-website.com/return?success=true&amp;code=&lt;authorization-code&gt;&amp;state=&lt;state-passed-in-from-before&gt;&amp;accountReference=&lt;accountReference&gt;</span>
</code><button>Copy</button></pre>

<a id="2-exchange-for-an-user-access-token" class="tsd-anchor"></a><h2 class="tsd-anchor-link">2. Exchange for an User Access Token<a href="#2-exchange-for-an-user-access-token" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The <code>code</code> returned in step 2 above can be used with the <code>codeVerifier</code> to exchange for a user access token. This allows you to request updated data from this user in the future for as long as the user access token is valid. Read more about the user access token <a href="User_creation_and_authorization.User_Access_Tokens.html">here</a>.</p>
<pre><code class="typescript"><span class="hl-9">// ... initialize the SDK</span><br/><br/><span class="hl-9">// authorizationCode - The code returned in the query parameter of the returned URL.</span><br/><span class="hl-9">// codeVerifier - The one stored from step 2.</span><br/><span class="hl-9">// contractDetails - The same one used in getAuthorizeUrl().</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">userAccessToken</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">sdk</span><span class="hl-1">.</span><span class="hl-0">exchangeCodeForToken</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-4">codeVerifier</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">authorizationCode</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">contractDetails</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-9">// Store the userAccessToken against the current user. We can use this for future reads.</span>
</code><button type="button">Copy</button></pre>

<a id="3-push-data" class="tsd-anchor"></a><h2 class="tsd-anchor-link">3. Push Data<a href="#3-push-data" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Once you have the <code>userAccessToken</code> from the steps above, we can push data!</p>
<p>Please take a look at push data to find out more about how to format the data to push.</p>
<pre><code class="typescript"><span class="hl-9">// ... initialize the SDK</span><br/><br/><span class="hl-9">// contractDetails - The same one used in getAuthorizeUrl().</span><br/><span class="hl-9">// userAccessToken - The user access token from the authorization step.</span><br/><span class="hl-9">// data - An object containing the buffer of the file to upload and some meta data.</span><br/><span class="hl-9">// onAccessTokenChange - A function that will be called when AccessToken is changed.</span><br/><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">sdk</span><span class="hl-1">.</span><span class="hl-0">pushData</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-4">contractDetails</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">userAccessToken</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">data:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">fileData:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">file</span><span class="hl-1">.</span><span class="hl-4">buffer</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">fileName:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">file</span><span class="hl-1">.</span><span class="hl-4">originalname</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">fileDescriptor:</span><span class="hl-1"> </span><span class="hl-6">JSON</span><span class="hl-1">.</span><span class="hl-0">parse</span><span class="hl-1">(</span><span class="hl-4">fileMeta</span><span class="hl-1">),</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-0">onAccessTokenChange</span><span class="hl-1">(</span><span class="hl-4">response</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-9">// Add logic to save new access token</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>If you want to use the push-to-provider flow (currently only supported for Medmij), here is an example:</p>
<pre><code class="typescript"><span class="hl-9">// ... initialize the SDK</span><br/><br/><span class="hl-9">// sourceType - (Optional) Use push to filter out only services that are used for push to provider type. Default SourceType is set to pull.</span><br/><span class="hl-9">// contractDetails - The same one used in getAuthorizeUrl().</span><br/><span class="hl-9">// userAccessToken - The user access token from the authorization step.</span><br/><span class="hl-9">// data - Medmij accepted object (type Record&lt;string, unknown&gt;).</span><br/><span class="hl-9">// onAccessTokenChange - A function that will be called when AccessToken is changed.</span><br/><span class="hl-9">// version - Currently supported versions are &quot;stu3&quot; and &quot;3.0.2&quot;.</span><br/><span class="hl-9">// standard - Supported standard is fhir</span><br/><span class="hl-9">// accountId - accountId can be found in readAccounts API and can be filterd out with accountReference that will be returned to you as explained in authorization process.</span><br/><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">sdk</span><span class="hl-1">.</span><span class="hl-0">pushData</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-4">push:</span><span class="hl-1"> </span><span class="hl-2">&quot;provider&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">version:</span><span class="hl-1"> </span><span class="hl-2">&quot;stu3&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">contractDetails</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">userAccessToken</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">data:</span><span class="hl-1"> {}, </span><span class="hl-9">// only medmij data object is acceptable</span><br/><span class="hl-1">    </span><span class="hl-0">onAccessTokenChange</span><span class="hl-1">(</span><span class="hl-4">response</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-9">// Add logic to save new access token</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-4">accountId</span><span class="hl-1">,</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>If we need to push more files to the users in the future, we can keep pushing as long as the user access token is valid.</p>
<a id="4-reading-files-back-out" class="tsd-anchor"></a><h2 class="tsd-anchor-link">4. Reading files back out<a href="#4-reading-files-back-out" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>If you've written data to the user, you can read it back out using the <a href="Quick_Start_Guides.Reading_Data_-_Step_by_step_guide.html">same process for reading user data</a>. You will need a new contract which reads out raw data, so please contact <a href="http://digi.me">digi.me</a> <a href="https://worlddataexchange.com/register">here</a> to get yours.</p>
<p>Note: Reading data is not possible for push to provider flow.</p>
<p>Make sure you pass in the user access token which you obtained in step 3 above when authorizing the new contract.</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#pushing-data---step-by-step-guide"><span>Pushing <wbr/>Data -<wbr/> <wbr/>Step by step guide</span></a><ul><li><a href="#1-onboarding-and-authorization"><span>1. <wbr/>Onboarding and <wbr/>Authorization</span></a></li><li><ul><li><a href="#getting-an-authorization-url-and-a-code-verifier"><span>Getting an authorization URL and a code verifier</span></a></li><li><a href="#redirect-the-user"><span>Redirect the user</span></a></li><li><a href="#redirect-back-to-your-application"><span>Redirect back to your application</span></a></li></ul></li><li><a href="#2-exchange-for-an-user-access-token"><span>2. <wbr/>Exchange for an <wbr/>User <wbr/>Access <wbr/>Token</span></a></li><li><a href="#3-push-data"><span>3. <wbr/>Push <wbr/>Data</span></a></li><li><a href="#4-reading-files-back-out"><span>4. <wbr/>Reading files back out</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">Node.js SDK for digi.me</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>
