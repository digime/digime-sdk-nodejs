<!DOCTYPE html><html class="default" lang="en" data-base="../"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>Authorizing | Node.js SDK for digi.me</title><meta name="description" content="Documentation for Node.js SDK for digi.me"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><link rel="stylesheet" href="../assets/custom.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => window.app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><a href="../index.html" class="title">Node.js SDK for digi.me</a><div id="tsd-toolbar-links"></div><button id="tsd-search-trigger" class="tsd-widget" aria-label="Search"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></button><dialog id="tsd-search" aria-label="Search"><input role="combobox" id="tsd-search-input" aria-controls="tsd-search-results" aria-autocomplete="list" aria-expanded="true" autocapitalize="off" autocomplete="off" placeholder="Search the docs" maxLength="100"/><ul role="listbox" id="tsd-search-results"></ul><div id="tsd-search-status" aria-live="polite" aria-atomic="true"><div>Preparing search index...</div></div></dialog><a href="#" class="tsd-widget menu" id="tsd-toolbar-menu-trigger" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb" aria-label="Breadcrumb"><li><a href="User_creation_and_authorization.html">User creation and authorization</a></li><li><a href="" aria-current="page">Authorizing</a></li></ul></div><div class="tsd-panel tsd-typography"><h1 id="authorizing" class="tsd-anchor-link">Authorizing<a href="#authorizing" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><p>In order to push or read data from library, we first need to create a user access token for each user.
User access tokens are linked to a contract, and it is possible to create multiple tokens that have access to the same library.
Authorization is the process of obtaining a user access token for the user.</p>
<h3 id="when-do-we-need-to-authorize" class="tsd-anchor-link">When do we need to authorize?<a href="#when-do-we-need-to-authorize" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Authorization is required in the following scenarios:</p>
<ul>
<li>For new users. During this process user will be asked to onboard first source/account.</li>
<li>For an existing user working with a different contract. For example, if they have shared data and now you would like to push data into their library.</li>
</ul>
<p>If you encounter the error <code>The token (refresh_token) is expired</code> please refer to the <a href="User_creation_and_authorization.Reauthorizing.html">getReauthorizeUrl</a> method.</p>
<h3 id="what-are-the-steps" class="tsd-anchor-link">What are the steps?<a href="#what-are-the-steps" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul>
<li>Obtain an authorization URL and a code verifier.</li>
<li>Redirect the user to the authorization URL.</li>
<li>Exchange the result for a user access token.</li>
</ul>
<h2 id="getting-a-authorization-url-and-a-code-verifier" class="tsd-anchor-link">Getting a authorization URL and a code verifier<a href="#getting-a-authorization-url-and-a-code-verifier" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> {</span><span class="hl-4">init</span><span class="hl-1">} </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@digime/digime-sdk-nodejs&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">sdk</span><span class="hl-1"> = </span><span class="hl-0">init</span><span class="hl-1">({ </span><span class="hl-4">applicationId:</span><span class="hl-1"> &lt;</span><span class="hl-7">you</span><span class="hl-1">-</span><span class="hl-7">application</span><span class="hl-1">-</span><span class="hl-7">id</span><span class="hl-1">&gt; });</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">contractDetails</span><span class="hl-1"> = {</span><br/><span class="hl-1">    </span><span class="hl-4">contractId:</span><span class="hl-1"> &lt;</span><span class="hl-7">your</span><span class="hl-1">-</span><span class="hl-7">contract</span><span class="hl-1">-</span><span class="hl-7">id</span><span class="hl-1">&gt;,</span><br/><span class="hl-1">    </span><span class="hl-4">privateKey:</span><span class="hl-1"> &lt;</span><span class="hl-7">private</span><span class="hl-1">-</span><span class="hl-7">key</span><span class="hl-1">-</span><span class="hl-7">for</span><span class="hl-1">-</span><span class="hl-7">contract</span><span class="hl-1">-</span><span class="hl-7">id</span><span class="hl-1">&gt;,</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-9">// contractDetails - The same one passed into getAuthorizeUrl().</span><br/><span class="hl-9">// callback - URL to be called after authorization is done.</span><br/><span class="hl-9">// serviceId - (Optional) During authorization, we can also ask user to onboard a service. ID can be found from querySources()</span><br/><span class="hl-9">// state - Put anything here to identify the user when authorization completes. This will be passed back in the callback.</span><br/><span class="hl-9">// userAccessToken - (Optional) User access token you may already have for this user from another contract.</span><br/><span class="hl-9">// sessionOptions - (Optional) An limits or scopes to set for this session.</span><br/><span class="hl-9">// sourceType - (Optional) Use push to filter out only services that are used for push to provider type. Default SourceType is set to pull.</span><br/><span class="hl-9">// sampleData - (Optional) Use for testing flow with sample datasets</span><br/><span class="hl-9">// locale - (Optional) Send preferred locale for authorization client to be used. Default is en.</span><br/><span class="hl-9">// includeSampleDataOnlySources - (Optional) Flag to indicate if we should include sample data only sources. Default is false.</span><br/><span class="hl-9">// storageId - (Optional) Provide storage.id returned createProvisionalStorage to connect this storage to created user</span><br/><span class="hl-9">// triggerQuery - (Optional) Flag to indicate if data query will be triggered post service authorisation. Default is true. If this is set to false data for added service will not be returned. You may want to set to false when adding multiple services subsequently and only get data for all services when adding last service.</span><br/><span class="hl-9">// sourcesScope - (Optional) scope is currently used only for pasing data type.</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">result</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">sdk</span><span class="hl-1">.</span><span class="hl-0">getAuthorizeUrl</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-4">contractDetails</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">callback:</span><span class="hl-1"> &lt;</span><span class="hl-7">an</span><span class="hl-1">-</span><span class="hl-7">url</span><span class="hl-1">-</span><span class="hl-7">to</span><span class="hl-1">-</span><span class="hl-7">call</span><span class="hl-1">-</span><span class="hl-7">when</span><span class="hl-1">-</span><span class="hl-7">authorization</span><span class="hl-1">-</span><span class="hl-7">is</span><span class="hl-1">-</span><span class="hl-7">done</span><span class="hl-1">&gt;,</span><br/><span class="hl-1">    </span><span class="hl-4">state:</span><span class="hl-1"> &lt;</span><span class="hl-7">any</span><span class="hl-1">-</span><span class="hl-7">extra</span><span class="hl-1">-</span><span class="hl-7">info</span><span class="hl-1">-</span><span class="hl-7">to</span><span class="hl-1">-</span><span class="hl-7">identify</span><span class="hl-1">-</span><span class="hl-7">user</span><span class="hl-1">&gt;</span><br/><span class="hl-1">    </span><span class="hl-4">serviceId</span><span class="hl-1">: </span><span class="hl-0">toNumber</span><span class="hl-1">(</span><span class="hl-4">serviceId</span><span class="hl-1">),</span><br/><span class="hl-1">    </span><span class="hl-4">userAccessToken:</span><span class="hl-1"> &lt;</span><span class="hl-7">access</span><span class="hl-1">-</span><span class="hl-7">token</span><span class="hl-1">&gt;,</span><br/><span class="hl-1">    </span><span class="hl-4">sessionOptions:</span><span class="hl-1"> &lt;{</span><br/><span class="hl-1">        </span><span class="hl-4">pull</span><span class="hl-1">: </span><span class="hl-7">PullSessionOptions</span><br/><span class="hl-1">    }&gt;,</span><br/><span class="hl-1">    </span><span class="hl-4">sourceType:</span><span class="hl-1"> </span><span class="hl-2">&quot;pull&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">sampleData:</span><span class="hl-1"> </span><span class="hl-4">SampleDataOptions</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">locale:</span><span class="hl-1"> </span><span class="hl-2">&quot;nl&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">includeSampleDataOnlySources:</span><span class="hl-1"> </span><span class="hl-5">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">storageId:</span><span class="hl-1"> </span><span class="hl-2">&quot;some-storage-id&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">triggerQuery:</span><span class="hl-1"> </span><span class="hl-5">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">sourcesScope:</span><span class="hl-1"> &lt;</span><span class="hl-7">options</span><span class="hl-1">-</span><span class="hl-7">to</span><span class="hl-1">-</span><span class="hl-7">scope</span><span class="hl-1">-</span><span class="hl-7">soruces</span><span class="hl-1">-</span><span class="hl-7">during</span><span class="hl-1">-</span><span class="hl-7">authorization</span><span class="hl-1">-</span><span class="hl-7">flow</span><span class="hl-1">&gt;</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-9">// =&gt; result will contain a url and a code verifier which you will need for later.</span><br/><span class="hl-9">// Calling the url returned will trigger the authorization process.</span>
</code><button type="button">Copy</button></pre>

<p>More details on types that can be passed into getAuthorizeUrl please check <a href="../interfaces/Types.GetAuthorizeUrlOptions.html" class="tsd-kind-interface">here</a>.</p>
<p>The <a href="../interfaces/Types.GetAuthorizeUrlResponse.html" class="tsd-kind-interface">result</a> returned will include a <code>url</code>, <code>codeVerifier</code> and <code>session</code>.
Store the <code>codeVerifier</code> against this user as this will be required for later.</p>
<p>Store <code>session</code> as well for getting data after authorization process is done.</p>
<p>More on limits and scoping of raw and mapped data interface can be found <a href="../interfaces/Types.PullSessionOptions.html" class="tsd-kind-interface">here</a>.</p>
<p>To test flow using sample data please check more details <a href="Sample_Datasets.html">here</a></p>
<h2 id="redirecting-the-user-to-this-authorization-url" class="tsd-anchor-link">Redirecting the user to this authorization URL<a href="#redirecting-the-user-to-this-authorization-url" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The URL returned is our authorization web onboard client, and will look something like this.</p>
<pre><code><span class="hl-10">https</span><span class="hl-1">:</span><span class="hl-9">//api.digi.me/apps/saas/authorize?code=&lt;code&gt;&amp;service=&lt;service-id&gt;</span>
</code><button>Copy</button></pre>

<p>Redirect the user to this URL, and they will be asked to onboard the service and consent to share the requested data.</p>
<p>On <em>success</em>, the <code>callback</code> provided above will be called with the follow extra query parameters:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Returned Always</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>success</code></td>
<td>Whether the call was successful. <code>true</code> or <code>false</code></td>
<td>Yes</td>
</tr>
<tr>
<td><code>state</code></td>
<td>The same string that was passed in to the <code>getAuthorizationUrl</code> call.</td>
<td>Yes</td>
</tr>
<tr>
<td><code>code</code></td>
<td>Authorization Code. Only returned when the authorization successful.</td>
<td>Yes</td>
</tr>
<tr>
<td><code>accountReference</code></td>
<td>This information can be used to get full account info when matching this number with reference number returned by readAccounts API. Only returned when the authorization successful.</td>
<td>Yes</td>
</tr>
</tbody>
</table>
<p>On <em>failure</em>, the <code>callbackUrl</code> provided will be called with the follow extra query parameters:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Returned Always</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>success</code></td>
<td>Whether the call was successful. <code>true</code> or <code>false</code></td>
<td>Yes</td>
</tr>
<tr>
<td><code>errorCode</code></td>
<td>If there was an error, an error code will be returned. Please see the error code section for a list of possible errors.</td>
<td>Yes</td>
</tr>
</tbody>
</table>
<h2 id="exchanging-the-result-for-an-user-access-token" class="tsd-anchor-link">Exchanging the result for an user access token.<a href="#exchanging-the-result-for-an-user-access-token" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Once we have the <code>code</code> from a successful authorization, we can combine that with the <code>codeVerifier</code> to exchange a User Access Token.</p>
<pre><code class="typescript"><span class="hl-9">// ... initialize the SDK</span><br/><br/><span class="hl-9">// authorizationCode - The code returned in the query parameter of the returned URL.</span><br/><span class="hl-9">// codeVerifier - The one returned from the result of getAuthorizeUrl().</span><br/><span class="hl-9">// contractDetails - The same one passed into getAuthorizeUrl().</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">userAccessToken</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">sdk</span><span class="hl-1">.</span><span class="hl-0">exchangeCodeForToken</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-4">codeVerifier</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">authorizationCode</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">contractDetails</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-9">// Store the userAccessToken against the current user. We can use this for future reads.</span>
</code><button type="button">Copy</button></pre>

<p>Once the above steps are completed, you will have an User Access Token for this user for this contract. You will be able to perform read/write tasks from their library.</p>
<p>Note that for the same user, if you'd like to authorize another contract, you'll need to provide the User Access Token when authorizing for the next contract.</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg><h3>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg><h3>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#authorizing"><span>Authorizing</span></a><ul><li><ul><li><a href="#when-do-we-need-to-authorize"><span>When do we need to authorize?</span></a></li><li><a href="#what-are-the-steps"><span>What are the steps?</span></a></li></ul></li><li><a href="#getting-a-authorization-url-and-a-code-verifier"><span>Getting a authorization URL and a code verifier</span></a></li><li><a href="#redirecting-the-user-to-this-authorization-url"><span>Redirecting the user to this authorization URL</span></a></li><li><a href="#exchanging-the-result-for-an-user-access-token"><span>Exchanging the result for an user access token.</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">Node.js SDK for digi.me</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>
