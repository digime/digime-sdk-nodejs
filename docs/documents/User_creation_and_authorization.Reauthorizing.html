<!DOCTYPE html><html class="default" lang="en" data-base="../"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>Reauthorizing | Node.js SDK for digi.me</title><meta name="description" content="Documentation for Node.js SDK for digi.me"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><link rel="stylesheet" href="../assets/custom.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => window.app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><a href="../index.html" class="title">Node.js SDK for digi.me</a><div id="tsd-toolbar-links"></div><button id="tsd-search-trigger" class="tsd-widget" aria-label="Search"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></button><dialog id="tsd-search" aria-label="Search"><input role="combobox" id="tsd-search-input" aria-controls="tsd-search-results" aria-autocomplete="list" aria-expanded="true" autocapitalize="off" autocomplete="off" placeholder="Search the docs" maxLength="100"/><ul role="listbox" id="tsd-search-results"></ul><div id="tsd-search-status" aria-live="polite" aria-atomic="true"><div>Preparing search index...</div></div></dialog><a href="#" class="tsd-widget menu" id="tsd-toolbar-menu-trigger" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb" aria-label="Breadcrumb"><li><a href="User_creation_and_authorization.html">User creation and authorization</a></li><li><a href="" aria-current="page">Reauthorizing</a></li></ul></div><div class="tsd-panel tsd-typography"><h1 id="reauthorizing" class="tsd-anchor-link">Reauthorizing<a href="#reauthorizing" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><p>If you are getting error <code>The token (refresh_token) is expired</code> you will need to call getReauthorizeUrl method:</p>
<h3 id="what-are-the-steps" class="tsd-anchor-link">What are the steps?<a href="#what-are-the-steps" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul>
<li>Getting a reauthorization URL and a code verifier from the <code>getReauthorizeUrl</code> method.</li>
<li>Redirecting the user to the reauthorization URL received from the <code>getReauthorizeUrl</code> method.</li>
<li>Exchanging the result for a fresh user access token..</li>
</ul>
<h2 id="getting-a-authorization-url-and-a-code-verifier" class="tsd-anchor-link">Getting a authorization URL and a code verifier<a href="#getting-a-authorization-url-and-a-code-verifier" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> {</span><span class="hl-4">init</span><span class="hl-1">} </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@digime/digime-sdk-nodejs&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">sdk</span><span class="hl-1"> = </span><span class="hl-0">init</span><span class="hl-1">({ </span><span class="hl-4">applicationId:</span><span class="hl-1"> &lt;</span><span class="hl-7">you</span><span class="hl-1">-</span><span class="hl-7">application</span><span class="hl-1">-</span><span class="hl-7">id</span><span class="hl-1">&gt; });</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">contractDetails</span><span class="hl-1"> = {</span><br/><span class="hl-1">    </span><span class="hl-4">contractId:</span><span class="hl-1"> &lt;</span><span class="hl-7">your</span><span class="hl-1">-</span><span class="hl-7">contract</span><span class="hl-1">-</span><span class="hl-7">id</span><span class="hl-1">&gt;,</span><br/><span class="hl-1">    </span><span class="hl-4">privateKey:</span><span class="hl-1"> &lt;</span><span class="hl-7">private</span><span class="hl-1">-</span><span class="hl-7">key</span><span class="hl-1">-</span><span class="hl-7">for</span><span class="hl-1">-</span><span class="hl-7">contract</span><span class="hl-1">-</span><span class="hl-7">id</span><span class="hl-1">&gt;,</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-9">// contractDetails - The same one passed into getReauthorizeUrl().</span><br/><span class="hl-9">// callback - URL to be called after authorization is done.</span><br/><span class="hl-9">// state - Put anything here to identify the user when authorization completes. This will be passed back in the callback.</span><br/><span class="hl-9">// userAccessToken - (Optional) User access token you may already have for this user from another contract.</span><br/><span class="hl-9">// sessionOptions - (Optional) An limits or scopes to set for this session.</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">result</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">sdk</span><span class="hl-1">.</span><span class="hl-0">getReauthorizeUrl</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-4">contractDetails</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">callback:</span><span class="hl-1"> &lt;</span><span class="hl-7">an</span><span class="hl-1">-</span><span class="hl-7">url</span><span class="hl-1">-</span><span class="hl-7">to</span><span class="hl-1">-</span><span class="hl-7">call</span><span class="hl-1">-</span><span class="hl-7">when</span><span class="hl-1">-</span><span class="hl-7">authorization</span><span class="hl-1">-</span><span class="hl-7">is</span><span class="hl-1">-</span><span class="hl-7">done</span><span class="hl-1">&gt;,</span><br/><span class="hl-1">    </span><span class="hl-4">state:</span><span class="hl-1"> &lt;</span><span class="hl-7">any</span><span class="hl-1">-</span><span class="hl-7">extra</span><span class="hl-1">-</span><span class="hl-7">info</span><span class="hl-1">-</span><span class="hl-7">to</span><span class="hl-1">-</span><span class="hl-7">identify</span><span class="hl-1">-</span><span class="hl-7">user</span><span class="hl-1">&gt;</span><br/><span class="hl-1">    </span><span class="hl-4">userAccessToken</span><span class="hl-1">: &lt;</span><span class="hl-7">access</span><span class="hl-1">-</span><span class="hl-7">token</span><span class="hl-1">&gt;,</span><br/><span class="hl-1">    </span><span class="hl-4">sessionOptions:</span><span class="hl-1"> &lt;{</span><br/><span class="hl-1">        </span><span class="hl-4">pull</span><span class="hl-1">: </span><span class="hl-7">PullSessionOptions</span><br/><span class="hl-1">    }&gt;,</span><br/><span class="hl-1">});</span><br/><br/><br/><span class="hl-9">// =&gt; result will contain a url, session and a code verifier which you will need for later.</span><br/><span class="hl-9">// Calling the url returned will trigger the reauthorization process.</span>
</code><button type="button">Copy</button></pre>

<p>More details on types that can be passed into getReauthorizeUrl please check <a href="../interfaces/Types.GetReauthorizeUrlOptions.html" class="tsd-kind-interface">here</a>.</p>
<p>The <a href="../interfaces/Types.GetReauthorizeUrlResponse.html" class="tsd-kind-interface">result</a> returned will include a <code>url</code>, <code>codeVerifier</code> and <code>session</code>.
Store the <code>codeVerifier</code> against this user as this will be required for later.</p>
<p>Store <code>session</code> as well for getting data after reauthorization process is done.</p>
<h2 id="redirecting-the-user-to-this-reauthorization-url" class="tsd-anchor-link">Redirecting the user to this reauthorization URL<a href="#redirecting-the-user-to-this-reauthorization-url" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The URL returned is the <a href="http://digi.me">digi.me</a> web onboard client, and will look something like this.</p>
<pre><code><span class="hl-10">https</span><span class="hl-1">:</span><span class="hl-9">//api.digi.me/apps/saas/user-reauth?code=&lt;code&gt;</span>
</code><button>Copy</button></pre>

<p>Redirect the user to this URL, and we will attempt to reauthorize user, during this process for security reasons we might ask user to onboard one of users existing accounts. If user is inactive for too long we might ask be able to recover user and you will need to do authorization process from scratch.</p>
<p>On <em>success</em>, the <code>callback</code> provided above will be called with the follow extra query parameters:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Returned Always</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>success</code></td>
<td>Whether the call was successful. <code>true</code> or <code>false</code></td>
<td>Yes</td>
</tr>
<tr>
<td><code>state</code></td>
<td>The same string that was passed in to the <code>getAuthorizationUrl</code> call.</td>
<td>Yes</td>
</tr>
<tr>
<td><code>code</code></td>
<td>Authorization Code. Only returned when the authorization successful.</td>
<td>Yes</td>
</tr>
</tbody>
</table>
<p>On <em>failure</em>, the <code>callbackUrl</code> provided will be called with the follow extra query parameters:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Returned Always</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>success</code></td>
<td>Whether the call was successful. <code>true</code> or <code>false</code></td>
<td>Yes</td>
</tr>
<tr>
<td><code>errorCode</code></td>
<td>If there was an error, an error code will be returned. Please see the error code section for a list of possible errors.</td>
<td>Yes</td>
</tr>
</tbody>
</table>
<h2 id="exchanging-the-result-for-an-user-access-token" class="tsd-anchor-link">Exchanging the result for an user access token.<a href="#exchanging-the-result-for-an-user-access-token" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Once we have the <code>code</code> from a successful authorization, we can combine that with the <code>codeVerifier</code> to exchange a User Access Token.</p>
<pre><code class="typescript"><span class="hl-9">// ... initialize the SDK</span><br/><br/><span class="hl-9">// authorizationCode - The code returned in the query parameter of the returned URL.</span><br/><span class="hl-9">// codeVerifier - The one returned from the result of getReauthorizeUrl().</span><br/><span class="hl-9">// contractDetails - The same one passed into getReauthorizeUrl().</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">userAccessToken</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">sdk</span><span class="hl-1">.</span><span class="hl-0">exchangeCodeForToken</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-4">codeVerifier</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">authorizationCode</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">contractDetails</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-9">// Store the userAccessToken against the current user. We can use this for future reads.</span>
</code><button type="button">Copy</button></pre>

<p>Once the above steps are completed, you will have a User Access Token for this user associated with this contract. You will be able to perform read and write tasks from their library.</p>
<p>Please note that if you are using an invalid token, the <code>getReauthorizeUrl</code> method will return an InvalidToken error (The token (access_token) is invalid), and you will not be able to reauthorize this user.</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg><h3>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg><h3>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#reauthorizing"><span>Reauthorizing</span></a><ul><li><ul><li><a href="#what-are-the-steps"><span>What are the steps?</span></a></li></ul></li><li><a href="#getting-a-authorization-url-and-a-code-verifier"><span>Getting a authorization URL and a code verifier</span></a></li><li><a href="#redirecting-the-user-to-this-reauthorization-url"><span>Redirecting the user to this reauthorization URL</span></a></li><li><a href="#exchanging-the-result-for-an-user-access-token"><span>Exchanging the result for an user access token.</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">Node.js SDK for digi.me</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>
